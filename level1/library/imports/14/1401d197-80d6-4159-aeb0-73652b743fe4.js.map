{"version":3,"sources":["assets/Scripts/HomeController.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Data from './Data';\n\nconst {ccclass, property} = cc._decorator;\nconst tween = cc.tween;\n@ccclass\nexport default class HomeController extends cc.Component {\n\n    @property(sp.Skeleton)\n    lupin: sp.Skeleton = null\n\n    @property(cc.Node)\n    ui: cc.Node = null;\n\n    @property(cc.Sprite)\n    wall: cc.Sprite = null;\n\n    @property(cc.Sprite)\n    floor: cc.Sprite = null;\n\n    @property(cc.Sprite)\n    bed: cc.Sprite = null;\n\n    @property(cc.Sprite)\n    tv: cc.Sprite = null;\n\n    @property(cc.Sprite)\n    window: cc.Sprite = null;\n\n    @property(cc.Sprite)\n    pricture: cc.Sprite = null;\n\n    @property(cc.Sprite)\n    toilet: cc.Sprite = null;\n\n    @property(cc.Label)\n    dayCount: cc.Label = null;\n\n    @property(cc.Node)\n    notification: cc.Node = null;\n\n    private _decorations = [];\n\n    onLoad() {\n        this._decorations = [this.wall, this.floor, this.bed, this.tv, this.window, this.pricture, this.toilet]\n        this.setCurrentDeco()\n        this.setLupinLoop()\n    }\n\n    onEnable(): void {\n        this.notification.active = true;\n        this.lupin.setSkin('Lupin')\n    }\n    \n    onDisable(): void {\n        this.notification.active = false;\n    }\n    \n    moveVertical(distance, duration, cb = () => {}) {\n        cc.tween(this.node)\n            .by(duration, {position: cc.v3(0, -distance)})\n            .call(cb)\n            .start()\n    }\n\n    setDecoration(decoIndex, sFrame) {\n        const deco = this._decorations[decoIndex]\n\n        if (deco) {\n            deco.node.opacity = 180\n            deco.spriteFrame = sFrame\n\n            tween(deco.node)\n                .delay(.5)\n                .to(.3, {opacity: 255})\n                .start()\n        }\n\n    }\n\n    setCurrentDeco() {\n        const gameData = Data.getData(Data.FACEBOOK_KEY, (err, data) => {\n            const gameData = data\n            const currentDeco = gameData.currentDeco || {}\n\n            Object.keys(currentDeco).forEach((cate) => {\n                const decoData = currentDeco[cate]\n                cc.resources.load(\n                    `Shop/${decoData.type}/${cate}_${decoData.type}`,\n                    cc.SpriteFrame,\n                    (err, sFrame) => {\n                        if (err) {\n                            sFrame = null\n                        }\n\n                        this.setDecoration(decoData.cateIndex, sFrame)\n                    },\n                )\n\n            })\n        })\n        \n    }\n\n    setLupinLoop() {\n        let count = 0\n\n        this.lupin.setCompleteListener((track) => {\n\n            if (track.animation.name === 'home/bed') {\n                count++\n                if (count >= 4) {\n                    count = 0\n                    this.setLupinToilet()\n                }\n            }\n\n            if (track.animation.name === 'emotion/sinister') {\n                count++\n                if (count >= 7) {\n                    count = 0\n                    this.setLupinBed()\n                }\n            }\n        })\n\n        this.setLupinStand()\n    }\n\n    setLupinOpacity() {\n        this.lupin.node.opacity = 180\n\n        tween(this.lupin.node)\n            .to(.5, {opacity: 255})\n            .start()\n    }\n\n    setLupinBed() {\n        Data.getData(Data.FACEBOOK_KEY, (err, data) => {\n            const gameData = data\n            const currentDeco = gameData.currentDeco\n\n            if (!currentDeco || !currentDeco.Giuong || !currentDeco.Giuong.type) {\n                return this.setLupinToilet()\n            }\n\n            this.lupin.timeScale = 1\n            this.lupin.setAnimation(0, 'emotion/idle', false)\n            this.lupin.setAnimation(1, 'home/bed', true)\n            this.lupin.clearTrack(0)\n            this.lupin.node.position = cc.v3(264, -378)\n\n            this.setLupinOpacity()\n        })\n        \n    }\n\n    setLupinStand() {\n        this.lupin.setAnimation(1, 'general/stand_thinking', false)\n        this.lupin.setAnimation(0, 'emotion/sinister', true)\n        this.lupin.node.position = cc.v3(19, -515)\n\n        this.setLupinOpacity()\n    }\n\n    setLupinToilet() {\n        this.lupin.setAnimation(1, 'home/seat_toilet', false)\n        this.lupin.setAnimation(0, 'emotion/idle', false)\n        this.lupin.node.position = cc.v3(-110, -305)\n        this.lupin.node.opacity = 180\n\n        tween(this.lupin.node)\n            .to(.5, {opacity: 255})\n            .repeat(\n                2,\n                tween()\n                    .call(() => {\n                        this.lupin.setAnimation(1, 'home/seat_toilet', true)\n                        this.lupin.setAnimation(0, 'emotion/idle', true)\n                    })\n                    .delay(5)\n                    .call(() => {\n                        this.lupin.clearTrack(0)\n                        this.lupin.setAnimation(1, 'home/seat_toilet2', false)\n                    })\n                    .delay(3)\n            )\n            .call(() => {\n                this.setLupinStand()\n            })\n            .start()\n    }\n\n    updateCalendar(): void {\n        Data.getData(Data.FACEBOOK_KEY, (err, data) => {\n            let day = 10 - (data.unlockedLevel % 10);\n            this.dayCount.string = day.toString();\n        });\n        \n    }\n}\n"]}