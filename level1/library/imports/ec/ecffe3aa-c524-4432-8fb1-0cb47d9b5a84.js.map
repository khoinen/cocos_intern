{"version":3,"sources":["assets/Scripts/ListLevel/ListLevel.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Data from \"../Data\";\nimport Effect from \"../EffectManager\";\nimport {STATUS} from \"./NewClickItem\";\n\nconst {ccclass, property} = cc._decorator;\n\n// Tổng số level của game\nconst TOTAL_LEVEL = 30;\n// Số level hiển thị trong 1 trang\nconst LEVEL_PAGE = 10;\n\nconst tween = cc.tween;\n\nvar _gameManager = null;\nvar _ui = null;\n\n@ccclass\nexport default class ListLevel extends cc.Component {\n\n    @property(cc.Node)\n    content: cc.Node = null;\n\n    @property(cc.PageView)\n    pageView: cc.PageView = null;\n\n    @property(cc.Prefab)\n    page: cc.Prefab = null;\n    \n    @property(cc.SpriteFrame)\n    unlock: cc.SpriteFrame = null;\n\n    @property(cc.SpriteFrame)\n    lock: cc.SpriteFrame = null\n    \n    @property(cc.SpriteFrame)\n    current: cc.SpriteFrame = null;\n\n    @property(cc.Node)\n    shadow: cc.Node = null;\n\n    @property(cc.Node)\n    container: cc.Node = null;\n\n    @property(cc.Prefab)\n    smallItem: cc.Prefab = null;\n\n    @property(cc.Prefab)\n    bigItem: cc.Prefab = null;\n\n    @property(cc.SpriteFrame)\n    icon: cc.SpriteFrame[] = [];\n\n    private _close;\n\n    onLoad(): void {\n        this.initItem();\n        _gameManager = cc.find(\"Canvas/GameManager\").getComponent(\"GameManager\");\n        _ui = cc.find(\"Canvas/UI\").getComponent(\"UIController\");\n        this.shadow.opacity = 0;\n        // this.container.scale = 0.7;\n        this.container.opacity = 0;\n        Data.getData(Data.FACEBOOK_KEY, (err, data) => {\n            _gameManager._selectedLevel = data.unlockedLevel;\n        })\n    }\n\n    onEnable(): void {\n        this.node.on(\"click_item\", this.onClickItem, this);\n        this.effectOpen();\n        this.setStatus();\n        var pageView = this.container.getChildByName(\"List\").getComponent(cc.PageView);\n        if (_gameManager._levelCurrent) {\n            let index = Math.floor((_gameManager._levelCurrent.level + 1) / 10);\n            pageView.setCurrentPageIndex(index);\n        }\n        else {\n            pageView.setCurrentPageIndex(0);\n        }\n    }\n\n    onDisable(): void {\n        this.node.off(\"click_item\", this.onClickItem, this);\n        this.unschedule(this._close);\n    }\n\n    initItem(): void {\n        let page = cc.instantiate(this.page);\n        let count = 0;\n        let item;\n        for (let i = 0; i < TOTAL_LEVEL; ++i)\n        {\n            if ((i + 1) % 10 == 0)\n                item = cc.instantiate(this.bigItem);\n            else\n                item = cc.instantiate(this.smallItem);\n            item.children[0].getComponent(cc.Sprite).spriteFrame = this.icon[i];\n            let script = item.getComponent(\"NewClickItem\");\n            script.tick.active = false;\n            script.setLevel(i + 1);\n            script.setStatus(STATUS.LOCK);\n            page.addChild(item);\n            \n            ++count;\n            if (count == LEVEL_PAGE && TOTAL_LEVEL >= LEVEL_PAGE)\n            {\n                this.content.addChild(page);\n                page = cc.instantiate(this.page);\n                count = 0;\n                if (i == TOTAL_LEVEL - 1)\n                {\n                    return;\n                }\n            }\n        }\n        this.content.addChild(page);\n    }\n\n    setStatus(): void {\n        Data.getData(Data.FACEBOOK_KEY, (err, data) => {\n            let unlockedLevel = data.unlockedLevel + 1;\n            let page = Math.floor(unlockedLevel / 10);\n            let count = 0;\n            if (page == 0) {\n                for (let i = 0; i < unlockedLevel; ++i)\n                {\n                    let item = this.content.children[0].children[i];\n                    let script = item.getComponent(\"NewClickItem\");\n                    script.isClick = true;\n                    if (i == unlockedLevel - 1) {\n                        script.setStatus(STATUS.CURRENT);\n                        script.tick.active = false;\n                    }\n                    else {\n                        script.setStatus(STATUS.UNLOCK);\n                        script.tick.active = true;\n                    }\n                }\n            }\n            else {\n                let numPage = 0;\n                let numItem = 0;\n                while (numItem < unlockedLevel) {\n                    let item = this.content.children[numPage].children[numItem];\n                    let script = item.getComponent(\"NewClickItem\");\n                    script.isClick = true;\n                    if (numPage * 10 + numItem == unlockedLevel - 1) {\n                        Effect.scaleForever(item, 0.95, 1.05, 0.7);\n                        script.setStatus(STATUS.CURRENT);\n                        script.tick.active = false;\n                        return;\n                    }\n                    if (numItem != unlockedLevel - 1) {\n                        script.setStatus(STATUS.UNLOCK);\n                        script.tick.active = true;\n                    }\n                    ++numItem;\n                    if (numItem == 10) {\n                        ++numPage;\n                        numItem = 0;\n                    }\n                }\n            }\n        });\n        \n    }\n    effectOpen(): void {\n        tween(this.shadow).to(0.2, {opacity: 200})\n                    .call(() => {\n                        tween(this.container).parallel(\n                            tween().to(0.2, {opacity: 255}),\n                            tween().to(0.2, {scale: 1}, {easing: \"quartOut\"})\n                        )\n                        .start();\n                    })\n                    .start();\n    }\n\n    effectClose(callback): void {\n        tween(this.shadow).to(0.2, {opacity: 0}).start();\n        tween(this.container).parallel(\n            tween().to(0.2, {opacity: 0}),\n            tween().to(0.2, {scale: 0.7}, {easing: \"quartOut\"})\n        )\n        .call(callback)\n        .start();\n    }\n\n    onClose(): void {\n        let _gameManager = cc.find(\"Canvas/GameManager\").getComponent(\"GameManager\");\n        _gameManager.playClickAudio()\n        this.effectClose(() => {\n            this.node.active = false;\n        });\n        this._close = function() {\n            this.node.active = false;\n        };\n        this.scheduleOnce(this._close, 0.3);\n    }\n\n    onClickItem(event: cc.Event.EventCustom): void {\n        var level = event.level;\n        _gameManager.selectLevel(level);\n        this.onClose();\n    }\n\n    previousPage(): void {\n        let index = this.pageView.getCurrentPageIndex();\n        if (index - 1 < 0)\n            return;\n        this.pageView.setCurrentPageIndex(index - 1);\n    }\n    nextPage(): void {\n        let index = this.pageView.getCurrentPageIndex();\n        this.pageView.setCurrentPageIndex(index + 1);\n    }\n\n    initItemNew(): void {\n\n    }\n}\n"]}