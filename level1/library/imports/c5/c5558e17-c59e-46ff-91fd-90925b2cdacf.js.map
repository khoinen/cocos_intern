{"version":3,"sources":["assets/Scripts/Data.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import FBInstantManager from './FBInstantManager';\n\nconst {ccclass, property} = cc._decorator;\n\nconst playerId = FBInstantManager.getInstance().getPlayerId()\n\nexport const LOCAL_KEY = \"userData\";\nexport const FACEBOOK_KEY = \"facebookData\";\n\n\n@ccclass\nexport default class Data {\n    public static LOCAL_KEY = LOCAL_KEY;\n    public static FACEBOOK_KEY = FACEBOOK_KEY;\n    public static FACEBOOK_LOCAL_KEY = \"facebookLocalUserData\";\n\n    public static defaultData = {\n        money: 0,\n        unlockedLevel: 18,\n        isSound: true,\n        isMusic: true,\n        isVibrate: true,\n    }\n\n    public static isLocal() {\n        return playerId === 'localId'\n    }\n\n    public static saveData(data: JSON, key: string = LOCAL_KEY, cb: Function = null): void {\n        if (key === LOCAL_KEY) {\n            cc.sys.localStorage.setItem(LOCAL_KEY, JSON.stringify(data));\n            cb && cb(null)\n        }\n\n        if (Data.isLocal() && key !== LOCAL_KEY) {\n            Data.saveData(data, Data.LOCAL_KEY)\n            return cb && cb(null)\n        }\n\n        if (key === FACEBOOK_KEY) {\n            FBInstantManager.getInstance().setPlayerData(data, (err) => {\n                err && console.log('save facebook err:', err)\n                cc.sys.localStorage.setItem(Data.FACEBOOK_LOCAL_KEY, JSON.stringify(data))\n                cb && cb(err)\n            })\n        }\n    }\n\n    public static getData(key: string = LOCAL_KEY, cb: Function = (...params) => {}) {\n        if (key === LOCAL_KEY) return Data.getLocalData(cb)\n        if (Data.isLocal() && key !== Data.LOCAL_KEY) return Data.getLocalData(cb)\n        if (key === FACEBOOK_KEY) return Data.getFacebookData(cb)\n    }\n\n    public static getLocalData(cb) {\n        let _data = cc.sys.localStorage.getItem(LOCAL_KEY);\n        if (_data)\n        {\n            cb(null, JSON.parse(_data));\n        }\n        else\n        {\n            var data = { ...Data.defaultData }\n            cb(null, data);\n        }\n    }\n\n    public static getFacebookData(cb) {\n        FBInstantManager.getInstance().getPlayerData((err, data) => {\n            if (err) {\n                console.log('get facebook data err', err)\n                const data = cc.sys.localStorage.getItem(Data.FACEBOOK_LOCAL_KEY)\n\n                if (data) {\n                    return cb(null, JSON.parse(data))\n                }\n\n                return cb(null, { ...Data.defaultData })\n            }\n\n            if (!data) {\n                return Data.getData(Data.LOCAL_KEY, (err, localData) => {\n                    cb(\n                        null,\n                        {\n                            ...Data.defaultData,\n                            ...localData,\n                        }\n                    )\n                })\n            }\n\n            cb(\n                null,\n                {\n                    ...Data.defaultData,\n                    ...data,\n                }\n            )\n        })\n    }\n\n    public removeData(): void {\n        cc.sys.localStorage.removeItem(LOCAL_KEY);\n    }\n}\n"]}